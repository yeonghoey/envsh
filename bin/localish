#!/usr/bin/env bash

set -euo pipefail

realdir() {
  if [[ -z "$1" ]]; then
    pwd
  else
    (
      cd "$(dirname "$1")"
      realdir "$(readlink "$(basename "$1")")"
    )
  fi
}

readonly LOCALISH="$(dirname "$(realdir "$0")")"

# ------------------------------------------------------------------------------

source "${LOCALISH}/lib/local.sh"
source "${LOCALISH}/lib/repo.sh"
source "${LOCALISH}/lib/file.sh"
source "${LOCALISH}/lib/cmd.sh"
source "${LOCALISH}/lib/os.sh"
source "${LOCALISH}/lib/ui.sh"

# ------------------------------------------------------------------------------

for recipe in "$@"; do
  noti "Run: '${recipe}'"
  if (source "${LOCALISH}/recipes/${recipe}.sh"); then
    noti "Done: '${recipe}'"
  else
    noti "Abort: '${recipe}'"
  fi
done
